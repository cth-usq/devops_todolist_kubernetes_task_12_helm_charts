mysql:
  config:
    init: |
      GRANT ALL PRIVILEGES ON app_db.* TO 'app_user'@'%';
      USE app_db;
      CREATE TABLE counter (
          id INT AUTO_INCREMENT PRIMARY KEY,
          value INT
      );

  service:
    ports:
      name: mysql
      port: 3306
    clusterIP: None

  secret:
    MYSQL_ROOT_PASSWORD: MTIzNA==
    MYSQL_USER: YXBwX3VzZXI=
    MYSQL_PASSWORD: MTIzNA==

  statefulSet:
    replicas: 2
    name: mysql
    repository: mysql
    version: 8.0
    storage: 2Gi

    resources:
      requests:
        cpu: 500m
        memory: 1Gi

    livenessProbe:
      exec:
        command: ["mysqladmin", "ping"]
      initialDelaySeconds: 30
      periodSeconds: 10
      timeoutSeconds: 5

    readinessProbe:
      exec:
        command: ["mysqladmin", "ping"]
      initialDelaySeconds: 5
      periodSeconds: 2
      timeoutSeconds: 1

    affinity:
      podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchExpressions:
                  - key: "app"
                    operator: In
                    values:
                    - mysql
              topologyKey: "kubernetes.io/hostname"
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
            - matchExpressions:
                - key: "app"
                  operator: In
                  values:
                  - "mysql"

    tolerations:
    - key: "app"
      operator: "Equal"
      value: "mysql"
      effect: "NoSchedule"
